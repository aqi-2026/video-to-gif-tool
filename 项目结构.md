# 项目文件结构说明

```
video-to-gif-tool/
│
├── video_to_gif.py          # 核心转换模块
│   ├── QualitySettings      # 质量配置类
│   │   ├── HIGH             # 高质量(15fps, 100%, 256色)
│   │   ├── MEDIUM           # 中等质量(10fps, 75%, 128色)
│   │   └── LOW              # 低质量(8fps, 50%, 64色)
│   └── VideoToGifConverter  # 视频转GIF转换器
│       ├── get_video_files()      # 获取视频文件列表
│       ├── convert_single()       # 转换单个视频
│       └── convert_batch()        # 批量转换
│
├── gui.py                   # 图形用户界面
│   ├── ConvertThread        # 转换线程(后台处理)
│   └── VideoToGifGUI        # 主窗口类
│       ├── 路径设置组
│       ├── 质量设置组
│       ├── 操作按钮
│       ├── 进度条
│       └── 日志输出
│
├── build_exe.py             # 打包脚本
│   └── main()               # 执行PyInstaller打包
│
├── build.bat                # Windows一键打包批处理
│
├── requirements.txt         # Python依赖列表
│   ├── moviepy==1.0.3      # 视频处理
│   ├── Pillow==10.1.0      # 图像处理
│   ├── PyQt5==5.15.10      # GUI框架
│   └── pyinstaller==6.3.0  # 打包工具
│
├── README.md                # 项目说明文档
├── 使用说明.md              # 详细使用说明
│
├── test_syntax.py           # 语法验证脚本
│
└── fin/                     # 打包输出目录
    └── VideoToGIF.exe      # 打包后的可执行文件

生成的临时文件(打包过程):
├── build/                   # PyInstaller构建临时文件
├── dist/                    # PyInstaller输出目录
└── VideoToGIF.spec         # PyInstaller配置文件
```

## 模块功能说明

### 1. video_to_gif.py - 核心转换模块

**主要类:**

- `QualitySettings`: 定义三种质量预设
  - `HIGH`: 高质量,适合需要最佳画质的场景
  - `MEDIUM`: 中等质量,推荐日常使用
  - `LOW`: 低质量,适合节省空间

- `VideoToGifConverter`: 转换器主类
  - 管理输入输出路径
  - 扫描支持的视频格式
  - 执行单个/批量转换
  - 提供进度回调接口

**支持的视频格式:**
- MP4, AVI, MOV, MKV, FLV, WMV, WebM, M4V

### 2. gui.py - 图形用户界面

**主要类:**

- `ConvertThread`: 后台转换线程
  - 继承自 QThread
  - 实现异步转换,防止UI卡顿
  - 提供进度信号和完成信号

- `VideoToGifGUI`: 主窗口
  - 提供友好的图形界面
  - 实时显示转换进度
  - 支持自定义输入输出路径
  - 提供质量选择下拉框
  - 显示详细日志信息

**界面组件:**
1. 路径设置组:输入/输出文件夹选择
2. 质量设置组:高中低三档质量选择
3. 操作按钮:扫描文件、开始转换
4. 进度条:显示转换进度
5. 日志区域:实时显示转换信息

### 3. build_exe.py - 打包脚本

**打包流程:**
1. 检查PyInstaller是否安装
2. 清理旧的构建文件
3. 执行PyInstaller打包
4. 将exe文件复制到fin目录
5. 清理临时文件

**打包参数:**
- `--name`: 指定程序名称
- `--onefile`: 打包成单个exe文件
- `--windowed`: 不显示控制台窗口
- `--clean`: 清理缓存
- `--noconfirm`: 不需要确认

### 4. build.bat - Windows批处理

自动化打包流程:
1. 检查Python环境
2. 安装依赖库
3. 执行打包脚本

## 工作流程

### 转换流程

```
用户操作 → 扫描视频 → 选择质量 → 开始转换
                                    ↓
                            创建转换线程
                                    ↓
                            逐个处理视频
                                    ↓
                        加载视频 → 应用质量设置 → 生成GIF
                                    ↓
                            更新进度显示
                                    ↓
                            转换完成提示
```

### 打包流程

```
运行build.bat → 安装依赖 → 执行build_exe.py
                                    ↓
                            PyInstaller打包
                                    ↓
                        生成dist/VideoToGIF.exe
                                    ↓
                        复制到fin/VideoToGIF.exe
                                    ↓
                            清理临时文件
```

## 技术栈

- **Python**: 3.7+
- **MoviePy**: 视频处理和GIF生成
- **Pillow**: 图像处理支持
- **PyQt5**: 跨平台GUI框架
- **PyInstaller**: Python打包工具

## 依赖关系

```
gui.py
  └─ video_to_gif.py
      ├─ moviepy.editor.VideoFileClip
      └─ pathlib.Path

build_exe.py
  └─ subprocess (调用PyInstaller)

test_syntax.py
  └─ ast (语法检查)
```

## 开发说明

### 添加新功能

1. **修改核心模块**: 编辑 `video_to_gif.py`
2. **更新界面**: 编辑 `gui.py`
3. **测试语法**: 运行 `python test_syntax.py`
4. **重新打包**: 运行 `build.bat` 或 `python build_exe.py`

### 调整质量预设

在 `video_to_gif.py` 的 `QualitySettings` 类中修改:
- `fps`: 帧率
- `scale`: 缩放比例
- `colors`: 颜色数量

### 添加支持的视频格式

在 `VideoToGifConverter.SUPPORTED_FORMATS` 列表中添加新格式。

---

由 MonkeyCode-AI 智能开发平台开发
